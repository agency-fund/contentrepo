{% extends 'wagtailadmin/reports/base_page_report.html' %}
{{ page.extra_scripts|safe }}
{% load i18n wagtailadmin_tags %}
{% block titletag %} Page views {% endblock %}

{% block content %}

    <header role="banner">
        <div class="row">
            <div class="left">
                <div class="col">
                    <h1>
                        {% if header_icon %}{% icon name=header_icon %}{% endif %}
                        {{ title }}{% if subtitle %} <span>{{ subtitle }}</span>{% endif %}
                    </h1>
                </div>
            </div>
            <div class="right report__actions">
                {% block actions %}
                    {% if view.list_export %}
                        <div class="dropdown dropdown-button match-width">
                            <a href="{{ view.xlsx_export_url }}" class="button bicolor button--icon">{% icon name="download" wrapped=1 %}{% trans 'Download XLSX' %}</a>
                            <div class="dropdown-toggle">{% icon name="arrow-down" %}</div>
                            <ul>
                                <li><a  class="button bicolor button--icon" href="{{ view.csv_export_url }}">{% icon name="download" wrapped=1 %}{% trans 'Download CSV' %}</a></li>
                            </ul>
                        </div>
                    {% endif %}
                {% endblock %}
            </div>
        </div>
    </header>

    <div class="report{% if filters %} report--has-filters{% endif %}">
        <div class="report__results">
            {% block results %}
            {% if page_obj %}
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
                <canvas id="pageViewsPerMonth"></canvas>
                <script>
                    var data_old = JSON.parse("{{page_view_data|escapejs}}");
                    var labels = data_old['labels']
                    var dataa = data_old['data']
                    new Chart("pageViewsPerMonth", {
                        type: 'line',
                        data: {
                            datasets: [{
                            pointRadius: 5,
                            pointBackgroundColor: "rgb(0,0,255)",
                            data: dataa
                            }],
                        },
                        options: {
                            responsive: true,
                            scales: {
                            y: {
                                    beginAtZero: true,
                                    type: 'linear',
                            },
                            x: {
                                    type: 'time',
                                    time: {
                                        unit: 'month'
                                    }
                            }
                            },
                            plugins: {
                            legend: false
                            }
                        }
            
                });
                </script>
                {% else %}
                {% block no_results %}
                    <p>{% trans "No pages match this report's criteria." %}</p>
                {% endblock %}
            {% endif %}
            {% endblock %}
        </div>
        {% if filters %}
            <div class="report__filters">
                <h2>{% trans 'Filter' %}</h2>
                <form method="get">
                    <button class="button button-longrunning" type="submit">{% icon name="spinner" %}{% trans 'Apply filters' %}</button>

                    {% for filter in filters.form %}
                        {{ filter.label_tag }}
                        {{ filter }}
                        {{ filter.errors }}
                    {% endfor %}
                </form>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% versioned_static 'wagtailadmin/css/layouts/report.css' %}" type="text/css" />
    {{ filters.form.media.css }}
{% endblock %}

{% block extra_js %}
    {{ block.super }}
    {{ filters.form.media.js }}
{% endblock %}